<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Actualités – Site d'information</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=Source+Sans+3:ital,wght@0,400;0,600;0,700;1,400&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Source Sans 3', sans-serif; }
    h1, .font-serif { font-family: 'Libre Baskerville', serif; }
    .article-content h1 { font-size: 1.75rem; margin-bottom: 0.75rem; }
    .article-content p { margin-bottom: 1rem; line-height: 1.65; }
    .article-content a { color: #1d4ed8; text-decoration: underline; }
  </style>
</head>
<body class="bg-stone-50 text-stone-800 min-h-screen">
  <header class="bg-white border-b border-stone-200 shadow-sm">
    <div class="max-w-5xl mx-auto px-4 py-5">
      <h1 class="font-serif text-2xl font-bold text-stone-900">Actualités</h1>
      <p class="text-stone-500 text-sm mt-0.5">Site d'information – Lecture seule</p>
    </div>
  </header>

  <main class="max-w-5xl mx-auto px-4 py-8">
    <!-- Liste des articles certifiés -->
    <section id="article-list" class="space-y-6">
      <!-- Rempli par JS -->
    </section>

    <!-- Détail d'un article (masqué par défaut) -->
    <section id="article-detail" class="hidden">
      <a href="#" id="back-to-list" class="inline-flex items-center text-blue-700 hover:underline mb-6 font-medium">
        ← Retour à la liste
      </a>
      <article id="article-detail-content" class="bg-white rounded-lg border border-stone-200 shadow-sm p-6 md:p-8">
        <!-- Rempli par JS -->
      </article>
    </section>
  </main>

  <footer class="border-t border-stone-200 mt-12 py-6 text-center text-stone-500 text-sm">
    <p>© Actualités – Tous les articles affichés sont certifiés et publiés.</p>
  </footer>

  <script src="data.js"></script>
  <script src="app.js"></script>
  <script>
    App.setRole('visitor');

    const listEl = document.getElementById('article-list');
    const detailSection = document.getElementById('article-detail');
    const detailContent = document.getElementById('article-detail-content');
    const backLink = document.getElementById('back-to-list');

    function renderList() {
      const articles = App.getArticlesForVisitor();
      if (articles.length === 0) {
        listEl.innerHTML = '<p class="text-stone-500 text-center py-12">Aucun article publié pour le moment.</p>';
        return;
      }
      listEl.innerHTML = articles.map(art => `
        <article class="bg-white rounded-lg border border-stone-200 shadow-sm overflow-hidden hover:shadow-md transition-shadow">
          <div class="p-5 md:p-6">
            <div class="flex flex-wrap items-center gap-2 mb-2">
              <span class="text-stone-500 text-sm">${App.formatDate(art.datePublication)}</span>
              <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-emerald-100 text-emerald-800">Article certifié SEO</span>
            </div>
            <h2 class="font-serif text-xl font-bold text-stone-900 mb-2">
              <a href="#" class="hover:underline article-link" data-id="${art.id}">${escapeHtml(art.titre)}</a>
            </h2>
            <p class="text-stone-600 text-sm leading-relaxed">${escapeHtml(App.getExcerpt(art.contenu, 200))}</p>
            <p class="mt-3">
              <a href="#" class="text-blue-700 font-medium text-sm hover:underline article-link" data-id="${art.id}">Lire la suite →</a>
            </p>
          </div>
        </article>
      `).join('');

      listEl.querySelectorAll('.article-link').forEach(link => {
        link.addEventListener('click', (e) => {
          e.preventDefault();
          showArticle(link.dataset.id);
        });
      });
    }

    function showArticle(id) {
      const art = CMS.getArticleById(id);
      if (!art || art.statut !== 'certified') {
        renderList();
        return;
      }
      listEl.classList.add('hidden');
      detailSection.classList.remove('hidden');
      detailContent.innerHTML = `
        <div class="flex flex-wrap items-center gap-2 mb-4 text-sm text-stone-500">
          <time>${App.formatDate(art.datePublication)}</time>
          <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-emerald-100 text-emerald-800">Article certifié SEO</span>
        </div>
        <h1 class="font-serif text-3xl font-bold text-stone-900 mb-6">${escapeHtml(art.titre)}</h1>
        <div class="article-content prose prose-stone max-w-none">${art.contenu}</div>
      `;
    }

    function escapeHtml(str) {
      if (!str) return '';
      const div = document.createElement('div');
      div.textContent = str;
      return div.innerHTML;
    }

    backLink.addEventListener('click', (e) => {
      e.preventDefault();
      detailSection.classList.add('hidden');
      listEl.classList.remove('hidden');
      renderList();
    });

    renderList();
  </script>
</body>
</html>
