<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Actualités – Information et décryptage</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=Source+Serif+4:ital,wght@0,400;0,600;0,700;1,400&family=Source+Sans+3:wght@400;500;600;700&display=swap"
    rel="stylesheet">
  <style>
    :root {
      --color-ink: #1a1a1a;
      --color-ink-soft: #4a4a4a;
      --color-muted: #6b7280;
      --color-border: #e5e7eb;
      --color-paper: #fafafa;
      --color-accent: #1e3a5f;
    }

    body {
      font-family: 'Source Sans 3', sans-serif;
      color: var(--color-ink);
      background: var(--color-paper);
    }

    .font-headline {
      font-family: 'Libre Baskerville', serif;
    }

    .font-editorial {
      font-family: 'Source Serif 4', serif;
    }

    .article-content {
      font-family: 'Source Serif 4', serif;
    }

    .article-content h1 {
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 1rem;
      line-height: 1.2;
      color: var(--color-ink);
    }

    .article-content p {
      margin-bottom: 1.25rem;
      line-height: 1.7;
      color: var(--color-ink-soft);
    }

    .article-content a {
      color: var(--color-accent);
      text-decoration: underline;
      text-underline-offset: 2px;
    }

    .article-content a:hover {
      text-decoration-thickness: 2px;
    }

    .img-cover {
      object-fit: cover;
    }

    .line-clamp-1 {
      display: -webkit-box;
      -webkit-line-clamp: 1;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .line-clamp-2 {
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
  </style>
</head>

<body class="min-h-screen antialiased">
  <!-- En-tête professionnel -->
  <header class="bg-white border-b border-stone-200">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 py-4">
      <div class="flex flex-wrap items-center justify-between gap-4">
        <a href="#"
          class="font-headline text-xl sm:text-2xl font-bold text-[var(--color-ink)] tracking-tight">Actualités</a>
        <p class="text-xs text-[var(--color-muted)] font-medium uppercase tracking-wider"><time id="header-date"></time>
        </p>
      </div>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-4 sm:px-6 py-8 sm:py-10">
    <!-- Liste : hero + secondaires + flux -->
    <section id="article-list" class="space-y-10 sm:space-y-12">
      <!-- Rempli par JS -->
    </section>

    <!-- Détail d'un article (masqué par défaut) -->
    <section id="article-detail" class="hidden">
      <nav class="mb-6">
        <a href="#" id="back-to-list"
          class="text-sm font-medium text-[var(--color-accent)] hover:underline inline-flex items-center gap-1">
          ← Retour à l'accueil
        </a>
      </nav>
      <article id="article-detail-content" class="bg-white">
        <!-- Rempli par JS -->
      </article>
    </section>
  </main>

  <footer class="border-t border-stone-200 mt-16 bg-white">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 py-8">
      <p class="text-xs text-[var(--color-muted)] text-center">© Actualités. Tous les articles affichés sont certifiés
        et publiés.</p>
    </div>
  </footer>

  <script src="data.js"></script>
  <script src="app.js"></script>
  <script>
    App.setRole('visitor');

    const listEl = document.getElementById('article-list');
    const detailSection = document.getElementById('article-detail');
    const detailContent = document.getElementById('article-detail-content');
    const backLink = document.getElementById('back-to-list');

    // Placeholders Unsplash – thème actualité/pro, remplaçables facilement
    const PLACEHOLDER_IMAGES = [
      'https://images.unsplash.com/photo-1504711434969-e33886168f5c?w=1200&q=80',
      'https://images.unsplash.com/photo-1586339949916-3e9457bef6d3?w=1200&q=80',
      'https://images.unsplash.com/photo-1495020689067-958852a7765e?w=1200&q=80',
      'https://images.unsplash.com/photo-1557804506-669a67965ba0?w=1200&q=80',
      'https://images.unsplash.com/photo-1526304640581-d334cdbbf45e?w=1200&q=80',
      'https://images.unsplash.com/photo-1504384308090-c894fdcc538d?w=1200&q=80',
    ];

    function getPlaceholder(index) {
      return PLACEHOLDER_IMAGES[index % PLACEHOLDER_IMAGES.length];
    }
    /** Image principale d'un article : image uploadée par le rédacteur ou placeholder */
    function getArticleImage(art, placeholderIndex) {
      return (art && art.imageData) ? art.imageData : getPlaceholder(placeholderIndex);
    }

    function setHeaderDate() {
      var el = document.getElementById('header-date');
      if (el) el.textContent = new Date().toLocaleDateString('fr-FR', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' });
    }

    function escapeHtml(str) {
      if (!str) return '';
      var div = document.createElement('div');
      div.textContent = str;
      return div.innerHTML;
    }

    function renderList() {
      var articles = App.getArticlesForVisitor();
      setHeaderDate();

      if (articles.length === 0) {
        listEl.innerHTML = '<p class="text-[var(--color-muted)] text-center py-16 font-editorial">Aucun article publié pour le moment.</p>';
        return;
      }

      var hero = articles[0];
      var secondary = articles.slice(1, 4);
      var rest = articles.slice(4);

      var html = '';

      // —— Hero (article principal) ——
      html += '<div class="grid grid-cols-1 lg:grid-cols-12 gap-6 lg:gap-8">';
      html += '  <div class="lg:col-span-7">';
      html += '    <a href="#" class="block group article-link" data-id="' + hero.id + '">';
      html += '      <div class="aspect-[16/10] bg-stone-200 overflow-hidden">';
      html += '        <img src="' + getArticleImage(hero, 0) + '" alt="" class="w-full h-full img-cover group-hover:scale-[1.02] transition-transform duration-300" loading="eager">';
      html += '      </div>';
      html += '    </a>';
      html += '  </div>';
      html += '  <div class="lg:col-span-5 flex flex-col justify-center">';
      html += '    <a href="#" class="article-link group block" data-id="' + hero.id + '">';
      html += '      <span class="text-xs font-medium text-[var(--color-muted)] uppercase tracking-wider">' + App.formatDate(hero.datePublication) + '</span>';
      html += '      <span class="ml-2 text-xs font-medium text-emerald-700 bg-emerald-50 px-2 py-0.5 rounded">Certifié SEO</span>';
      html += '      <h2 class="font-headline text-2xl sm:text-3xl lg:text-4xl font-bold text-[var(--color-ink)] mt-2 leading-tight group-hover:text-[var(--color-accent)] transition-colors">' + escapeHtml(hero.titre) + '</h2>';
      html += '      <p class="font-editorial text-[var(--color-ink-soft)] mt-3 text-base leading-relaxed">' + escapeHtml(App.getExcerpt(hero.contenu, 220)) + '</p>';
      html += '      <span class="inline-block mt-4 text-sm font-medium text-[var(--color-accent)] group-hover:underline">Lire la suite</span>';
      html += '    </a>';
      html += '  </div>';
      html += '</div>';

      // —— Secondaires (2 ou 3) ——
      if (secondary.length > 0) {
        html += '<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-' + Math.min(secondary.length, 3) + ' gap-6 lg:gap-8 pt-6 border-t border-stone-200">';
        secondary.forEach(function (art, i) {
          html += '<article class="bg-white overflow-hidden">';
          html += '  <a href="#" class="block group article-link" data-id="' + art.id + '">';
          html += '    <div class="aspect-[16/10] bg-stone-200 overflow-hidden">';
          html += '      <img src="' + getArticleImage(art, i + 1) + '" alt="" class="w-full h-full img-cover group-hover:scale-[1.02] transition-transform duration-300" loading="lazy">';
          html += '    </div>';
          html += '    <div class="py-3">';
          html += '      <span class="text-xs text-[var(--color-muted)]">' + App.formatDate(art.datePublication) + '</span>';
          html += '      <span class="ml-2 text-xs font-medium text-emerald-700 bg-emerald-50 px-2 py-0.5 rounded">Certifié SEO</span>';
          html += '      <h3 class="font-headline text-lg sm:text-xl font-bold text-[var(--color-ink)] mt-1.5 leading-snug group-hover:text-[var(--color-accent)] transition-colors">' + escapeHtml(art.titre) + '</h3>';
          html += '      <p class="text-sm text-[var(--color-ink-soft)] mt-1 line-clamp-2">' + escapeHtml(App.getExcerpt(art.contenu, 120)) + '</p>';
          html += '    </div>';
          html += '  </a>';
          html += '</article>';
        });
        html += '</div>';
      }

      // —— Flux (reste des articles) ——
      if (rest.length > 0) {
        html += '<div class="pt-6 border-t border-stone-200">';
        html += '  <h2 class="sr-only">Autres articles</h2>';
        html += '  <ul class="space-y-0 divide-y divide-stone-200">';
        rest.forEach(function (art, i) {
          html += '<li>';
          html += '  <a href="#" class="flex flex-col sm:flex-row gap-4 py-5 sm:py-6 group article-link" data-id="' + art.id + '">';
          html += '    <div class="sm:w-40 flex-shrink-0 aspect-video sm:aspect-[16/10] bg-stone-200 overflow-hidden rounded">';
          html += '      <img src="' + getArticleImage(art, 4 + i) + '" alt="" class="w-full h-full img-cover group-hover:scale-[1.02] transition-transform duration-300" loading="lazy">';
          html += '    </div>';
          html += '    <div class="min-w-0 flex-1">';
          html += '      <span class="text-xs text-[var(--color-muted)]">' + App.formatDate(art.datePublication) + '</span>';
          html += '      <span class="ml-2 text-xs font-medium text-emerald-700 bg-emerald-50 px-2 py-0.5 rounded">Certifié SEO</span>';
          html += '      <h3 class="font-headline text-base sm:text-lg font-bold text-[var(--color-ink)] mt-1 group-hover:text-[var(--color-accent)] transition-colors">' + escapeHtml(art.titre) + '</h3>';
          html += '      <p class="text-sm text-[var(--color-ink-soft)] mt-0.5 line-clamp-1">' + escapeHtml(App.getExcerpt(art.contenu, 100)) + '</p>';
          html += '    </div>';
          html += '  </a>';
          html += '</li>';
        });
        html += '  </ul>';
        html += '</div>';
      }

      listEl.innerHTML = html;

      listEl.querySelectorAll('.article-link').forEach(function (link) {
        link.addEventListener('click', function (e) {
          e.preventDefault();
          showArticle(link.dataset.id);
        });
      });
    }

    function showArticle(id) {
      var art = CMS.getArticleById(id);
      if (!art || art.statut !== 'certified') {
        renderList();
        return;
      }
      listEl.classList.add('hidden');
      detailSection.classList.remove('hidden');
      detailContent.innerHTML =
        '<div class="aspect-[21/9] sm:aspect-[3/1] bg-stone-200 overflow-hidden rounded-t-lg">' +
        '<img src="' + getArticleImage(art, 0) + '" alt="" class="w-full h-full img-cover" loading="eager">' +
        '</div>' +
        '<div class="max-w-3xl mx-auto px-4 py-8 sm:py-10">' +
        '<p class="text-sm text-[var(--color-muted)]">' + App.formatDate(art.datePublication) + ' <span class="ml-2 font-medium text-emerald-700 bg-emerald-50 px-2 py-0.5 rounded">Certifié SEO</span></p>' +
        '<h1 class="font-headline text-3xl sm:text-4xl font-bold text-[var(--color-ink)] mt-2 leading-tight">' + escapeHtml(art.titre) + '</h1>' +
        '<div class="article-content mt-8 text-lg">' + art.contenu + '</div>' +
        '</div>';
    }

    backLink.addEventListener('click', function (e) {
      e.preventDefault();
      detailSection.classList.add('hidden');
      listEl.classList.remove('hidden');
      renderList();
    });

    renderList();
  </script>
</body>

</html>