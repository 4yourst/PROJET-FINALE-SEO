<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lagune Info – L'actualité économique et financière</title>

  <link rel="stylesheet" href="visitor.css">
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:wght@400;700&family=Source+Serif+4:wght@400;600;700&family=Source+Sans+3:wght@400;600;700&display=swap">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="tailwind-config.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>

<body class="bg-white min-h-screen text-gray-900 font-sans">

  <!-- Header -->
  <header class="border-b border-gray-200 sticky top-0 bg-white z-50">
    <!-- Top Bar (Date/Edition) - Hidden on mobile -->
    <div class="bg-gray-50 border-b border-gray-100 hidden sm:block">
      <div
        class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-1 flex justify-between items-center text-xs text-gray-500 font-medium uppercase tracking-wide">
        <time id="header-date"></time>
        <div class="space-x-4">
          <button type="button" class="hover:text-brand-green btn-subscribe">S'abonner</button>
          <a href="login.html" class="hover:text-brand-green">Connexion</a>
        </div>
      </div>
    </div>

    <!-- Main Header -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-16 sm:h-20">

        <!-- Mobile Menu Button -->
        <button class="sm:hidden p-2 text-gray-500">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
        </button>

        <!-- Logo -->
        <a href="index.html" class="group flex items-center gap-3">
          <div
            class="bg-brand-green w-10 h-10 sm:w-12 sm:h-12 flex items-center justify-center text-white font-bold text-xl sm:text-2xl font-serif rounded-sm group-hover:bg-opacity-90 transition-colors">
            LI
          </div>
          <div class="flex flex-col">
            <span class="text-2xl sm:text-3xl font-bold font-serif leading-none tracking-tight text-brand-ink">Lagune
              <span class="text-brand-yellow">.</span> Info</span>
            <span class="text-xs font-sans text-brand-gray tracking-widest uppercase mt-0.5">L'actualité en
              continu</span>
          </div>
        </a>
        <!-- Search Icon (Desktop) -->
        <div class="hidden sm:flex items-center">
          <div class="relative">
            <input type="text" placeholder="Rechercher..."
              class="pl-3 pr-8 py-1.5 border border-gray-300 rounded-full text-sm focus:outline-none focus:border-brand-green w-48 transition-all focus:w-64">
            <svg class="w-4 h-4 absolute right-3 top-2.5 text-gray-400" fill="none" stroke="currentColor"
              viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
            </svg>
          </div>
        </div>

        <!-- Search Icon (Mobile) -->
        <button class="sm:hidden p-2 text-gray-500">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
          </svg>
        </button>
      </div>
    </div>

    <!-- NavBar -->
    <nav class="border-t border-gray-100 hidden sm:block">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-center space-x-8 py-3" id="main-nav">
          <a href="#" data-cat="all"
            class="nav-item text-xs lg:text-sm font-bold uppercase tracking-widest text-brand-green border-b-2 border-brand-green pb-0.5">Accueil</a>
          <a href="#" data-cat="Politique"
            class="nav-item text-xs lg:text-sm font-bold uppercase tracking-widest text-gray-600 hover:text-brand-green transition-colors pb-0.5 border-b-2 border-transparent hover:border-brand-green">Politique</a>
          <a href="#" data-cat="Économie"
            class="nav-item text-xs lg:text-sm font-bold uppercase tracking-widest text-gray-600 hover:text-brand-green transition-colors pb-0.5 border-b-2 border-transparent hover:border-brand-green">Économie</a>
          <a href="#" data-cat="Entreprises"
            class="nav-item text-xs lg:text-sm font-bold uppercase tracking-widest text-gray-600 hover:text-brand-green transition-colors pb-0.5 border-b-2 border-transparent hover:border-brand-green">Entreprises</a>
          <a href="#" data-cat="Tech-Médias"
            class="nav-item text-xs lg:text-sm font-bold uppercase tracking-widest text-gray-600 hover:text-brand-green transition-colors pb-0.5 border-b-2 border-transparent hover:border-brand-green">Tech-Médias</a>
          <a href="#" data-cat="Société"
            class="nav-item text-xs lg:text-sm font-bold uppercase tracking-widest text-gray-600 hover:text-brand-green transition-colors pb-0.5 border-b-2 border-transparent hover:border-brand-green">Société</a>
          <a href="#" data-cat="Monde"
            class="nav-item text-xs lg:text-sm font-bold uppercase tracking-widest text-gray-600 hover:text-brand-green transition-colors pb-0.5 border-b-2 border-transparent hover:border-brand-green">Monde</a>
        </div>
      </div>
    </nav>
  </header>

  <!-- Main Content -->
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12">

    <!-- Section: À la une (Hero) -->
    <section id="hero-section" class="mb-12 border-b border-gray-200 pb-12">
      <!-- Injecté par JS -->
      <div class="animate-pulse flex space-x-4">
        <div class="flex-1 space-y-4 py-1">
          <div class="h-40 bg-gray-200 rounded"></div>
          <div class="space-y-2">
            <div class="h-4 bg-gray-200 rounded"></div>
            <div class="h-4 bg-gray-200 rounded w-5/6"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- Section: Grille Secondaire + Liste Latérale -->
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 lg:gap-12">

      <!-- Colonne Principale (Grille) -->
      <div class="lg:col-span-8">
        <h3
          class="font-sans font-bold text-brand-green uppercase tracking-widest text-xs mb-6 border-b border-brand-green inline-block pb-1">
          En continu</h3>
        <div id="grid-section" class="grid grid-cols-1 md:grid-cols-2 gap-8">
          <!-- Injecté par JS -->
        </div>
      </div>

      <!-- Colonne Latérale (Derniers / Filler) -->
      <aside class="lg:col-span-4 border-l border-gray-100 pl-0 lg:pl-8 mt-10 lg:mt-0">
        <h3
          class="font-sans font-bold text-gray-900 uppercase tracking-widest text-xs mb-6 border-b border-gray-200 pb-2">
          Les plus lus</h3>
        <ul id="list-section" class="space-y-6 divide-y divide-gray-100">
          <!-- Injecté par JS -->
        </ul>

        <!-- Publicité / Promo Box -->
        <div class="mt-10 bg-gray-50 p-6 border border-gray-100 text-center">
          <p class="font-headline text-lg font-bold mb-2">Abonnez-vous</p>
          <p class="text-sm text-gray-500 mb-4">Accédez à tous nos articles en illimité.</p>
          <button
            class="bg-brand-yellow text-black px-6 py-2 text-sm font-bold uppercase tracking-wide hover:brightness-95 transition-all btn-subscribe">Je
            m'abonne</button>
        </div>
      </aside>

    </div>

  </main>

  <footer class="bg-gray-900 text-white border-t-4 border-brand-green mt-20">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12 text-center text-sm text-gray-400">
      <p class="mb-4">&copy; 2026 Lagune Info. Site de démonstration pour projet pédagogique.</p>
    </div>
  </footer>

  <!-- Scripts -->
  <script src="data.js"></script>
  <script src="app.js"></script>
  <script>
    App.setRole('visitor');

    // Placeholders
    const PLACEHOLDER_IMAGES = [
      'https://images.unsplash.com/photo-1504711434969-e33886168f5c?w=1200&q=80',
      'https://images.unsplash.com/photo-1586339949916-3e9457bef6d3?w=1200&q=80',
      'https://images.unsplash.com/photo-1495020689067-958852a7765e?w=1200&q=80',
      'https://images.unsplash.com/photo-1557804506-669a67965ba0?w=1200&q=80',
      'https://images.unsplash.com/photo-1526304640581-d334cdbbf45e?w=1200&q=80',
      'https://images.unsplash.com/photo-1504384308090-c894fdcc538d?w=1200&q=80',
    ];

    function getArticleImage(art, index) {
      if (art && art.imageData) return art.imageData;
      return PLACEHOLDER_IMAGES[(art.id || index) % PLACEHOLDER_IMAGES.length];
    }

    function formatDate(dateStr) {
      if (!dateStr) return '';
      const d = new Date(dateStr);
      return d.toLocaleDateString('fr-FR', { day: 'numeric', month: 'short' }); // "12 oct."
    }

    function renderHome(category = 'all') {
      let articles = CMS.getCertifiedArticles().sort((a, b) => b.id - a.id);

      // Filtering
      if (category !== 'all') {
        articles = articles.filter(a => a.category === category);
      }

      // Update Nav UI
      document.querySelectorAll('.nav-item').forEach(el => {
        const cat = el.dataset.cat;
        if (cat === category) {
          el.className = 'nav-item text-xs lg:text-sm font-bold uppercase tracking-widest text-brand-green border-b-2 border-brand-green pb-0.5';
        } else {
          el.className = 'nav-item text-xs lg:text-sm font-bold uppercase tracking-widest text-gray-600 hover:text-brand-green transition-colors pb-0.5 border-b-2 border-transparent hover:border-brand-green';
        }
      });

      // Update Section Title
      const sectionTitle = document.querySelector('#grid-section').previousElementSibling;
      sectionTitle.textContent = category === 'all' ? 'En continu' : category;

      // Date Header (unchanged)
      document.getElementById('header-date').textContent = new Date().toLocaleDateString('fr-FR', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' });

      if (articles.length === 0) {
        document.getElementById('hero-section').innerHTML = ''; // Clear hero
        document.getElementById('grid-section').innerHTML = '<p class="text-center py-10 text-gray-500 col-span-2">Aucun article dans cette catégorie pour le moment.</p>';
        return;
      }

      // Logic for Hero vs Grid vs List
      // If filtering, we might want a simpler view, but keeping the "Hero + Grid" layout works fine for filtering too.
      // We just take the first one as Hero.

      const heroArticle = articles[0];
      const gridArticles = articles.slice(1, 5); // Next 4

      // For the Sidebar list, if we are filtering, maybe we still want to show "Most Read" (random/mixed) or filtered?
      // Standard UX: Main content filters, Sidebar often stays "Most Read" (global) or "Most Read in Category".
      // Let's keep Sidebar as "Global Most Read" (simulated by taking all certified articles shuffle/slice) to keep sidebar populated.
      // OR to be simple: Sidebar shows next articles of current filter. 
      // User request implies "Functional categories", usually affects main feed.
      // Let's make Sidebar show "Global" items to keep the page balanced even if category has few items.
      const listArticles = CMS.getCertifiedArticles().sort(() => 0.5 - Math.random()).slice(0, 5);


      // 1. Rendu Hero
      const heroHTML = `
         <article class="grid grid-cols-1 lg:grid-cols-12 gap-8 items-start group cursor-pointer" onclick="location.href='article.html?id=${heroArticle.id}'">
            <div class="lg:col-span-8 order-2 lg:order-1 relative overflow-hidden aspect-[16/9] bg-gray-100">
               <img src="${getArticleImage(heroArticle, 0)}" class="absolute inset-0 w-full h-full object-cover transition-transform duration-700 group-hover:scale-105" alt="${heroArticle.titre}">
               <div class="absolute top-2 left-2 bg-brand-yellow text-black text-xs font-bold px-2 py-1 uppercase tracking-wider">${heroArticle.category || 'Actualité'}</div>
            </div>
            <div class="lg:col-span-4 order-1 lg:order-2 flex flex-col justify-center h-full py-2">
               <span class="text-brand-green font-bold uppercase text-xs tracking-wider mb-2">À la une</span>
               <h1 class="font-headline text-3xl sm:text-4xl lg:text-4xl font-bold leading-tight mb-4 group-hover:text-brand-green transition-colors">
                  ${heroArticle.titre}
               </h1>
               <p class="font-serif-text text-gray-600 text-lg leading-relaxed mb-4 line-clamp-4">
                  ${App.getExcerpt ? App.getExcerpt(heroArticle.contenu, 200) : 'Lire l\'article...'}
               </p>
               <div class="text-xs text-gray-400 font-medium uppercase tracking-wide mt-auto">
                  ${formatDate(heroArticle.datePublication)} <span class="mx-1">•</span> Lecture 3 min
               </div>
            </div>
         </article>
       `;
      document.getElementById('hero-section').innerHTML = heroHTML;

      // 2. Rendu Grille
      let gridHTML = '';
      gridArticles.forEach(art => {
        gridHTML += `
            <article class="flex flex-col group cursor-pointer border-b border-gray-100 pb-6 md:border-none" onclick="location.href='article.html?id=${art.id}'">
               <div class="aspect-[3/2] bg-gray-100 mb-4 overflow-hidden relative">
                  <img src="${getArticleImage(art, art.id)}" class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105" loading="lazy">
                  <div class="absolute bottom-0 left-0 bg-white/90 px-2 py-1 text-xs font-bold text-gray-900 uppercase tracking-widest">${art.category || 'Actu'}</div>
               </div>
               <h3 class="font-headline text-xl font-bold leading-tight mb-2 group-hover:text-brand-green transition-colors">
                  ${art.titre}
               </h3>
               <p class="text-gray-500 text-sm line-clamp-2 leading-relaxed mb-3">
                  ${App.getExcerpt ? App.getExcerpt(art.contenu, 100) : ''}
               </p>
               <time class="text-xs text-gray-400 uppercase tracking-wide">${formatDate(art.datePublication)}</time>
            </article>
          `;
      });
      document.getElementById('grid-section').innerHTML = gridHTML;

      // 3. Rendu Liste (Sidebar - Global)
      let listHTML = '';
      if (listArticles.length > 0) {
        listArticles.forEach((art, index) => {
          listHTML += `
               <li class="pt-4 first:pt-0">
                  <article class="group cursor-pointer flex gap-4" onclick="location.href='article.html?id=${art.id}'">
                     <span class="text-3xl font-bold text-gray-200 font-headline group-hover:text-brand-green transition-colors">${index + 1}</span>
                     <div>
                        <span class="text-[10px] uppercase font-bold text-brand-golden mb-1 block text-brand-yellow tracking-wider">${art.category || ''}</span>
                        <h4 class="font-bold text-base leading-snug group-hover:text-brand-green transition-colors mb-1">
                           ${art.titre}
                        </h4>
                        <time class="text-xs text-gray-400 uppercase tracking-wide">${formatDate(art.datePublication)}</time>
                     </div>
                  </article>
               </li>
             `;
        });
      }
      document.getElementById('list-section').innerHTML = listHTML;
    }

    // Modal Subscription
    function handleSubscribe() {
      Swal.fire({
        title: 'Abonnez-vous à Lagune Info',
        html: `
              <p class="text-sm text-gray-600 mb-4">Accédez à l'intégralité de nos articles et soutenez le journalisme indépendant.</p>
              <input type="email" id="swal-input-email" class="swal2-input" placeholder="votre@email.com">
          `,
        showCancelButton: true,
        confirmButtonText: 'Je m\'abonne',
        confirmButtonColor: '#ffb929',
        cancelButtonText: 'Plus tard',
        cancelButtonColor: '#AFAFAF',
        customClass: {
          confirmButton: 'text-black font-bold'
        },
        preConfirm: () => {
          const email = Swal.getPopup().querySelector('#swal-input-email').value;
          if (!email) {
            Swal.showValidationMessage('Veuillez entrer une adresse email valide');
          }
          return { email: email };
        }
      }).then((result) => {
        if (result.isConfirmed) {
          Swal.fire({
            title: 'Merci !',
            text: `Bienvenue parmi nos abonnés. Un email de confirmation a été envoyé à ${result.value.email}.`,
            icon: 'success',
            confirmButtonColor: '#83A697'
          });
        }
      });
    }

    // Init
    document.addEventListener('DOMContentLoaded', () => {
      renderHome('all');

      // Nav Listeners
      document.querySelectorAll('.nav-item').forEach(link => {
        link.addEventListener('click', (e) => {
          e.preventDefault();
          const cat = link.dataset.cat;
          renderHome(cat);
        });
      });

      // Subscribe Listeners
      document.querySelectorAll('.btn-subscribe').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.preventDefault();
          handleSubscribe();
        });
      });
    });

  </script>
</body>

</html>